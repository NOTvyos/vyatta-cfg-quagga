type: txt
help: DHCP interface that supplies the next-hop IP address for this static route
allowed:
        local -a array ;
        array=( /var/lib/dhcp/en* /var/lib/dhcp/eth* /var/lib/dhcp/br* /var/lib/dhcp/bond* ) ;
        echo  -n ${array[@]##*/}
create:
        ifc="$VAR(@)"
        route="$VAR(../@)"
        table="$VAR(../../@)"
        sudo /opt/vyatta/sbin/vyatta-update-static-route.pl --interface=$ifc --route=$route --table=$table --option=create
        RIP=$(/opt/vyatta/sbin/vyatta-dhcp-helper.pl --interface=$ifc --want=router)
        if [ "$RIP" != "127.0.0.1" ]; then
	        vtysh -c "configure terminal" \
                  -c "ip route $route $RIP table $table"
        fi
        if [ "$route" == "0.0.0.0/0" ]; then
            LIP=$(/opt/vyatta/sbin/vyatta-dhcp-helper.pl --interface=$ifc --want=local)
            if [ "$LIP" != "127.0.0.1" ]; then
                MARK=`printf "0x%x" $((2147483647+$table))`
                sudo /sbin/iptables -t mangle -I OUTPUT -s $LIP/32 -j MARK --set-mark $MARK
            fi
        fi
update:
        ifc="$VAR(@)"
        route="$VAR(../@)"
        table="$VAR(../../@)"
        sudo /opt/vyatta/sbin/vyatta-update-static-route.pl --interface=$ifc --route=$route --table=$table --option=create
        RIP=$(/opt/vyatta/sbin/vyatta-dhcp-helper.pl --interface=$ifc --want=router)
        if [ "$RIP" != "127.0.0.1" ]; then
	        vtysh -c "configure terminal" \
                  -c "ip route $route $RIP table $table"
        fi
        if [ "$route" == "0.0.0.0/0" ]; then
            LIP=$(/opt/vyatta/sbin/vyatta-dhcp-helper.pl --interface=$ifc --want=local)
            if [ "$LIP" != "127.0.0.1" ]; then
                MARK=`printf "0x%x" $((2147483647+$table))`
                sudo /sbin/iptables -t mangle -I OUTPUT -s $LIP/32 -j MARK --set-mark $MARK
            fi
        fi
delete:
        ifc="$VAR(@)"
        route="$VAR(../@)"
        table="$VAR(../../@)"
        sudo /opt/vyatta/sbin/vyatta-update-static-route.pl --interface=$ifc --route=$route --table=$table --option=delete
        RIP=$(/opt/vyatta/sbin/vyatta-dhcp-helper.pl --interface=$ifc --want=router)
        if [ "$RIP" != "127.0.0.1" ]; then
	        vtysh -c "configure terminal" \
                  -c "no ip route $route $RIP table $table"
        fi
        if [ "$route" == "0.0.0.0/0" ]; then
            LIP=$(/opt/vyatta/sbin/vyatta-dhcp-helper.pl --interface=$ifc --want=local)
            if [ "$LIP" != "127.0.0.1" ]; then
                MARK=`printf "0x%x" $((2147483647+$table))`
                sudo /sbin/iptables -t mangle -D OUTPUT -s $LIP/32 -j MARK --set-mark $MARK
            fi
        fi
